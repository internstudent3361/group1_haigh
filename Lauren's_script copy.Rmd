---
title: "Code"
author: "Lauren Abdallah"
date: "03/07/2021"
output:
  html_document: 
    theme: lumen
    toc: true
  pdf_document: default
---

# Experiment 1 
 
```{r}

#Loading relevant packages
library(qualtRics)
library(tidyverse) #for dplyr and ggplot
library(ggbeeswarm)
library(ggeasy)
library(patchwork)

#Reading the data from my working directory using the qualtRics 'read_survey' function - Notably, this function removes the text in rows 2 and 3 (not part of the data)
#This function also sets all relevant columns to 'numeric' rather than 'character', which allows us to do descriptive calculations, mutate new variables, and plot data
mydata=read_survey("Study_1_data.csv")

# CONVERT mydata to a data.frame - the qualtRics package Formats the data to a tibble rather than a data frame - converting mydata into a data.frame fixes the rounding issue in my numeric calculations 
mydata<- as.data.frame(mydata)

# Checking the types of variable we have (e.g., numeric, string, character etc.) **Note that relevant columns for calculations are 'numeric'
sapply(mydata, class) %>% as.data.frame.list()

```

## 1. Filtering Data (Exp 1) 
```{r}

#Count how many times the survey was opened i.e. the number of observations (anyone with progress >= 1%)   [371] 
mydata %>% count(Progress>=1) #371

#Renaming variables "SC0" to "recall_score" and "FL_10_DO" to "condition"
mydata <- mydata %>% rename(Recall_score = SC0, Condition = FL_10_DO)

#UNPLANNED EXCLUSION: Some participants completed the study twice, thus there are duplicated IDs (identified through the Profilic_PID variable) that must be filtered out
mydata %>% count(duplicated(Prolific_PID)) #count duplicates (TRUE = 59, FALSE = 312)
mydata <- mydata[!duplicated(mydata$Prolific_PID), ] #remove duplicate rows from mydata - this function removes the second (duplicate) response  
mydata %>% count(Progress>=1) #Ensure that the no. of observations are now 312 (59 were removed)

#PLANNED EXCLUSIONS:
# Applying exclusion criteria: participants who finished the study (Finished==1), declared that they answered seriously (seriousness_check==1) AND scored 4 or above on recall
# NOTE: Filtering for 'Finished' excludes those who didn't consent automatically
# THEN creating a subset of relevant variables 

mydata <- mydata %>% 
    filter(
      Consent == 1,
      Finished == 1,
      Serious_check == 1,
      Recall_score >= 4) %>% 
    select(
      Finished,
      `Duration (in seconds)`,
      Gender,
      Age,
      Serious_check, 
      Recall_score,
      Condition,
      contradiction_1:advancement)
  
#Count how many participants remain after exclusions (final sample size = 294)
mydata %>% summarise(n())
Total_n <- mydata %>% summarise(n())

#Export the data to a .csv
write_csv(mydata, "MyDataSubset.csv")
```

## 2. Descriptive stats > Calculating demographics (Exp 1)

```{r}
#AGE: Calculating the mean, SD, and range
mydata %>% summarise(mean(Age), sd(Age), range(Age)) # M = 34.29, SD = 12.67, Range = 18-69

#GENDER: No. of males(Value: '1') and females('2'), Other('3') and Prefer not to say('4'):
mydata %>% count(Gender) #male = 126, female = 168, other = 0, prefer not = 0
```

## 3. Descriptive stats > Descriptive ggplots (Exp 1)

```{r}
##For contradiction plot, must create a NEW variable: sum of the six contradiction ratings
mydata <- mydata %>%
  mutate(contradiction = contradiction_1 + contradiction_2 + contradiction_3 + contradiction_4 + contradiction_5 + contradiction_6)

##For all plots
#Separate the data in Condition into 4 columns to separate levels of each IV  ("Block_1_Generic_Conflict", "Block_2_Generic_Consistent", "Block_3_Qualified_Conflict" and "Block_4_Qualified_Consistent")
mydata <- separate(mydata, Condition, c("block", "number", "Format", "Conflict"))

#Set relevant IV columns ("Format" and "Conflict" as factors) 
mydata <- mydata %>%
  mutate(Format=as.factor(Format)) %>%
  mutate(Conflict=as.factor(Conflict))

sapply(mydata, class) #to check

#Rename from Conflict/Consistent to Conf./Non-Conf.

#Export the FINAL data to a .csv
write_csv(mydata, "MyDataFinalSubset.csv")

##Violin ggplots

#Making our own function 
figure.1.fun <- function(y_var, plot_title, y_title, lim_1, lim_2)  {
  ggplot(mydata,aes(x = Conflict, y = y_var, fill = Conflict)) +
  geom_violin() +
  facet_wrap(vars(Format), strip.position = "bottom") +
  stat_summary(fun.data = "mean_cl_normal", geom = "crossbar", fill = "white",
    alpha = .7) +
  geom_beeswarm(cex = 0.2) + 
  ggtitle(label = plot_title) +
  easy_center_title() +
  easy_remove_legend() +
  scale_x_discrete(name = NULL) +
  scale_y_continuous(name = y_title, limits = c(lim_1, lim_2)) +
  scale_fill_manual(values = c("slategray2", "lightpink1")) }

#Plotting Contradiction, Advancement and Confusion plots using function 
contradiction.plot <- figure.1.fun(y_var = mydata$contradiction, plot_title = "Contradiction", y_title = "Perceived Contradiction", lim_1 = 1, lim_2= 30) 
advancement.plot <- figure.1.fun(y_var = mydata$advancement, plot_title = "Advancement", y_title = "Perceived Scientific Advancement", lim_1 = -1, lim_2 = 1)
confusion.plot <- figure.1.fun(y_var = mydata$confusion, plot_title = "Confusion", y_title = "Confusion", lim_1 = 1, lim_2 = 5)

print(contradiction.plot)
print(advancement.plot)
print(confusion.plot)

```

```{r, fig.width=10, fig.height=11}
# Combine plots using the package patchwork()
combinedplots1 <- contradiction.plot + advancement.plot + confusion.plot + plot_layout(ncol = 2)
print(combinedplots1)

```

## 4. Descriptive stats > Pre-registered analysis of group means (Exp 1)

```{r}
##Conflicting vs non. conflicting group means (pre-registered analysis)

#Perceived Contradiction: Participants exposed to conflicting headlines perceived greater contradiction between the six headline pairs (M = 25.3) than those exposed to non-conflicting headlines (M = 13.4)
contradiction_means <- mydata %>%       # Specify data frame
  group_by(Conflict) %>%                # Specify group indicator
  summarise_at(vars(contradiction),     # Specify column
               list(name = mean))       # Specify function
print(contradiction_means)

#Advancement: The mean response of those exposed to non-conflicting headlines (0.007) was greater than the mean response of those exposed to conflicting headlines (-0.25)
advancement_means <- mydata %>%         # Specify data frame
  group_by(Conflict) %>%                # Specify group indicator
  summarise_at(vars(advancement),       # Specify column
               list(name = mean))       # Specify function
print(advancement_means)

#Confusion: Participants exposed to conflicting headlines indicated greater agreement that ‘the headlines create confusion about how to be healthy’ than those exposed to non-conflicting headlines (4.52 vs 3.65 on a 5-point scale)
confusion_means <- mydata %>%           # Specify data frame
  group_by(Conflict) %>%                # Specify group indicator
  summarise_at(vars(confusion),         # Specify column
               list(name = mean))       # Specify function
print(confusion_means)
```

## 5. Descriptive stats > Descriptive Historgram (Exp 1)
```{r}
# The following histogram plots how many people selected  -1 / 0 / +1 on the advancement scale for each of the four conditions

#FIRST adding value labels - using the ordered() function for ordinal data.
advancementvalue <- ordered(mydata$advancement,
        levels = c(-1, 0, 1),
        labels = c("Less", "Same", "More")) #labeling the levels of advancement

advancement_histogram <- ggplot(mydata) + geom_bar(
  aes(
    x=advancementvalue, 
    group = Conflict:Format,    
    fill = Conflict:Format),
  position = "dodge")+     #plotting side by side
  scale_x_discrete(name = "Advancement")+
  scale_y_continuous(name = "Number of Participants")+
  scale_fill_grey(name = "Condition", 
                  labels = c("Conflicting/Generic", 
                             "Conflicting/Qualified",
                             "Non-conflicting/Generic",
                             "Non-conflicting/Qualified"))
print(advancement_histogram)
```

# Experiment 2

```{r}
#Reading the data from my working directory using the qualtRics 'read_survey' function - Notably, this function removes the text in rows 2 and 3 (not part of the data)
#This function also sets all relevant columns to 'numeric' rather than 'character', which allows us to do descriptive calculations, mutate new variables, and plot data
mydata2=read_survey("Study_2_data.csv")

# CONVERT mydata to a data.frame - the qualtRics package Formats the data to a tibble rather than a data frame - converting mydata into a data.frame fixes the rounding issue in my numeric calculations 
mydata2<- as.data.frame(mydata2)

# Checking the types of variable we have (e.g., numeric, string, character etc.) **Note that relevant columns for calculations are 'numeric'
sapply(mydata2, class) %>% as.data.frame.list()

```

## 1. Filtering Data (Exp 2) 

```{r}
#Count how many times the survey was opened i.e. the number of observations (anyone with progress >= 1%) [412] 
mydata2 %>% count(Progress>=1) #412

#Renaming variables "SC0" to "Recall_score" and "FL_10_DO" to "Condition"
mydata2 <- mydata2 %>% rename(Recall_score = SC0, Condition = FL_12_DO)

#PLANNED EXCLUSIONS:
# Applying exclusion criteria: creating a subset of participants who finished the study (Finished==1), declared that they answered seriously (seriousness_check==1) AND scored 4 or above on recall
# THEN creating a subset of relevant variables 

mydata2 <- mydata2 %>% 
  filter(
    Consent == 1,
    Finished == 1,
    Serious_check == 1,
    Recall_score >= 4) %>% 
  select(
    Finished,
    `Duration (in seconds)`,
    Gender,
    Age,
    Serious_check, 
    Recall_score,
    Condition,
    NC_1:Development_sci_know_6)

#Count how many participants remain after exclusions (final sample size = 400)
mydata2 %>% summarise(n())
Total_n2 <- mydata2 %>% summarise(n())

#Export the subset of data to a .csv
write_csv(mydata2, "MyDataSubset2.csv")

```

## 2. Descriptive stats > Calculating demographics (Exp 2)

```{r}
#AGE: Calculating the mean, SD, and range
mydata2 %>% summarise(mean(Age), sd(Age), range(Age)) # M = 33.5, SD = 12, Range = 18-73

#GENDER: Counting the no. of males(Value: '1') and females('2'), Other('3') and Prefer not to say('4'):
mydata2 %>% count(Gender) #male = 150, female = 248, other = 2, prefer not = 0
```

## 3. Descriptive stats > Descriptive ggplots (Exp 2)

```{r}
##For all plots
#Separate the data in Condition into 4 columns to separate levels of each IV  ("Block_1_Generic_Conflict"...)
mydata2 <- separate(mydata2, Condition, c("block", "number", "Format", "Conflict"))

#set these new IV columns as factors 
mydata2 <- mydata2 %>%
  mutate(Format=as.factor(Format)) %>%
  mutate(Conflict=as.factor(Conflict)) 

sapply(mydata2, class) #to check

#calculate the average for each scale -- dplyr
#nutritional confusion mean
mydata2 <- mydata2 %>%
  mutate(confusion = (NC_1 + NC_2 + NC_3 + NC_4 + NC_5 + NC_6)/6)

#nutritional backlash mean
mydata2 <- mydata2 %>%
  mutate(backlash = (NBS_1 + NBS_2 + NBS_3 + NBS_4 + NBS_5 + NBS_6)/6)

#Mistrust of expertise mean
mydata2 <- mydata2 %>%
  mutate(mistrust = (Mistrust_expertise_1 + Mistrust_expertise_2 +
    Mistrust_expertise_3)/3)

#Confidence in scientific community = single column ('GSS')

#Certainty of knowledge mean
mydata2 <- mydata2 %>%
  mutate(certainty = (Certainty_sci_know_1 + Certainty_sci_know_2 +
    Certainty_sci_know_3 + Certainty_sci_know_4 + Certainty_sci_know_5 + 
    Certainty_sci_know_6)/6)

#Development of knowledge mean
mydata2 <- mydata2 %>%
  mutate(development = (Development_sci_know_1 + Development_sci_know_2 +
    Development_sci_know_3 + Development_sci_know_4 + Development_sci_know_5 +
    Development_sci_know_6)/6)

#Export the FINAL data to a .csv
write_csv(mydata2, "MyDataFinalSubset2.csv")

##Violin ggplots

#Make our own function
figure.2.fun <- function(y_var, plot_title, y_title, lim_2 = 5) {
  ggplot(mydata2, aes(x= Conflict, y = y_var, fill = Conflict)) +
  geom_violin() +
  facet_wrap(vars(Format), strip.position = "bottom") +
  stat_summary(fun.data = "mean_cl_normal",geom = "crossbar", fill = "white",
    alpha = .7) +
  geom_beeswarm(cex = 0.2) +
  ggtitle(label = plot_title) +
  easy_center_title() +
  easy_remove_legend() +
  scale_x_discrete(name = NULL) +
  scale_y_continuous(name = y_title, limits= c(1,lim_2)) +
  scale_fill_manual(values = c("slategray2", "lightpink1")) } 

#Use function to make plots
nutritionalconfusion.plot <- figure.2.fun(y_var = mydata2$confusion, plot_title = "Nutritional Confusion", y_title = "Nutritional Confusion")
nutritionalbacklash.plot <- figure.2.fun(y_var = mydata2$backlash, plot_title = "Nutritional Backlash", y_title = "Nutritional Backlash")
mistrust.plot <- figure.2.fun(y_var = mydata2$mistrust, plot_title = "Mistrust of Expertise", y_title = "Mistrust of Expertise")
confidence.plot <- figure.2.fun(y_var = mydata2$GSS, plot_title = "Confidence in Scientific Community", y_title = "Confidence in Scientific Community", lim_2 = 3)
certainty.plot <- figure.2.fun(y_var = mydata2$certainty, plot_title = "Certainty of Knowledge", y_title = "Certainty of Knowledge")
development.plot <- figure.2.fun(y_var = mydata2$development, plot_title = "Development of Knowledge", y_title = "Development of Knowledge")

print(nutritionalconfusion.plot)
print(nutritionalbacklash.plot)
print(mistrust.plot)
print(confidence.plot)
print(certainty.plot)
print(development.plot)

```

```{r, fig.width=10, fig.height=11}
# Combine plots using the package patchwork()
combinedplots2 <- nutritionalconfusion.plot + nutritionalbacklash.plot + mistrust.plot + confidence.plot + certainty.plot + development.plot + plot_layout(ncol = 2)
print(combinedplots2)
```

```

